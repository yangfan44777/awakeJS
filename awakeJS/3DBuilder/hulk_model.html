<html>



<style>

</style>
<script>

function EventUtil () {

	

};

EventUtil.addListener = function ( ele , type , handler ) {

 	if ( ele.addEventListener ) {
	
		ele.addEventListener( type, handler, false );
		
	} else if ( ele.attachEvent ) {
	
		ele.attachEvent( "on" + type, handler );
		
	} else { return; }
 
};

EventUtil.removeListener = function ( ele, type , handler ) {

	if ( ele.removeEventListener ) {
	
		ele.removeEventListener( type , handler , false );
	
	} else if ( ele.detachEvent ) {
	
		ele.detachEvent( "on" + type , handler );
	
	} else { return; }

};

function Renderer ( canvas ) {

	this.canvas = canvas;
	

};
Renderer.compareDepth = function ( a , b) {

	return   b.depth - a.depth; 

};

Renderer.prototype = {

	constructor : Renderer,
	                                      
	render : function ( faces , camera ) {
		
		camera.update();
	
		var facesLen = faces.length;
		
		var matrixWorldInverse = camera.matrixWorldInverse;
		var projectionMatrix = camera.projectionMatrix;
		
		var canvas = this.canvas;
		var ctx =  canvas.getContext('2d');
		
		var centerWidth = canvas.width / 2 , centerHeight = canvas.height / 2;
		
		ctx.clearRect( 0, 0, canvas.width, canvas.height );
		
		
		
		for ( var i = 0 ; i < facesLen ; i++ ) {
		
			var face = faces[i];
			
			var cloneA = face.a.clone().applyMatrix4( matrixWorldInverse );
			var cloneB = face.b.clone().applyMatrix4( matrixWorldInverse );
			var cloneC = face.c.clone().applyMatrix4( matrixWorldInverse );
			
			face.depth = cloneA.depth + cloneB.depth + cloneC.depth;
			
			face.a.sx = cloneA.applyProjection( projectionMatrix ).sx + centerWidth;
			face.a.sy = cloneA.applyProjection( projectionMatrix ).sy + centerHeight;
			face.b.sx = cloneB.applyProjection( projectionMatrix ).sx + centerWidth;
			face.b.sy = cloneB.applyProjection( projectionMatrix ).sy + centerHeight;
			face.c.sx = cloneC.applyProjection( projectionMatrix ).sx + centerWidth;
			face.c.sy = cloneC.applyProjection( projectionMatrix ).sy + centerHeight;
			
			
		}
		   
		
			
			/* sort Z */			
			faces.sort( Renderer.compareDepth  );
			
			/* draw */
			for ( var i = 0 ; i < facesLen ; i++ ) {
			
			
			
				var face = faces[i];
				
				
				
				
				var style = face.material.style;
				
				var B_ = face.material.matrix;
				
				
				var M = new Matrix3( face.b.sx - face.a.sx , face.c.sx - face.a.sx , face.a.sx , face.b.sy - face.a.sy , face.c.sy - face.a.sy , face.a.sy , 0 , 0 , 1 );
		
				var R = new Matrix3();
				
				M.multiply( R , B_);
				
				/*扩大面，减少裂痕*/
				var polySize = 1.3;//沿重心延长线增加1.3像素
				var x0 = face.a.sx,y0 = face.a.sy;
				
				var x1 = face.b.sx, x2 = face.c.sx , y1 = face.b.sy, y2 = face.c.sy;
		
				var cx = ( x0 + x1 + x2 ) * 1/3;
				var cy = ( y0 + y1 + y2 ) * 1/3;

				var xd = x0 - cx;
				var yd = y0 - cy;
				var l = polySize / Math.sqrt( xd * xd + yd * yd );
				x0 += xd * l;
				y0 += yd * l;
				xd = x1 - cx; yd = y1 - cy;
				l = polySize / Math.sqrt( xd * xd + yd * yd );
				x1 += xd * l;
				y1 += yd * l;
				xd = x2 - cx; yd = y2 - cy;
				l = polySize / Math.sqrt( xd * xd + yd * yd );
				x2 += xd * l;
				y2 += yd * l;
	
		
				ctx.fillStyle = style;
		
				ctx.beginPath();
				ctx.moveTo( x0 , y0 );
				ctx.lineTo( x1 , y1 );
				ctx.lineTo( x2 , y2 );
				
				ctx.closePath();
		
				
				ctx.save();
				ctx.setTransform( R.elements[0],  R.elements[3],  R.elements[1], R.elements[4],  R.elements[2],  R.elements[5] );
				ctx.fill();
				ctx.restore();
				
		
		
		
		}
	}

}

function Material () {

	/* 保存小画布、变换矩阵 */
	
	this.style = null;
	
	this.matrix = new Matrix4();

	this.visible = true;
};

Material.prototype = {

	constructor : Material 
	
}


function Matrix3 ( m11, m12 , m13 ,  m21 , m22 , m23 , m31 , m32 , m33  ) {
	
	this.elements = [];
	
	var t = this.elements;
	
	t[0] = m11; t[1] = m12; t[2] = m13;
	t[3] = m21; t[4] = m22; t[5] = m23; 
	t[6] = m31; t[7] = m32; t[8] = m33;
	
}

Matrix3.prototype = {

	constructor : Matrix3,
	
	identity : function () {
		
		var t = this.elements;
		
		t[0] = 1; t[1] = 0; t[2] = 0;
		t[3] = 0; t[4] = 1; t[5] = 0; 
		t[6] = 0; t[7] = 0; t[8] = 1;
		
		return this;
	},
	
	/* this矩阵 乘以 m ，结果存储在r中 */
	multiply : function ( r , m ) {
		
		var ae = this.elements;
		var be = m.elements;
		var re = r.elements;
		
		var a11 = ae[0], a12 = ae[1], a13 = ae[2];
		var a21 = ae[3], a22 = ae[4], a23 = ae[5];
		var a31 = ae[6], a32 = ae[7], a33 = ae[8];
	
		
		var b11 = be[0], b12 = be[1], b13 = be[2];
		var b21 = be[3], b22 = be[4], b23 = be[5];
		var b31 = be[6], b32 = be[7], b33 = be[8];
	
		
		re[0] = a11 * b11 + a12 * b21 + a13 * b31 ;
		re[1] = a11 * b12 + a12 * b22 + a13 * b32 ;
		re[2] = a11 * b13 + a12 * b23 + a13 * b33 ;
	
		
		re[3] = a21 * b11 + a22 * b21 + a23 * b31 ;
		re[4] = a21 * b12 + a22 * b22 + a23 * b32 ;
		re[5] = a21 * b13 + a22 * b23 + a23 * b33 ;
		
		
		re[6] = a31 * b11 + a32 * b21 + a33 * b31 ;
		re[7] = a31 * b12 + a32 * b22 + a33 * b32 ;
		re[8] = a31 * b13 + a32 * b23 + a33 * b33 ;
		
		
	
		
	},
	
	inverse : function () {
		
		var m = this.elements;
		
		var m11 = m[0];var m12 = m[1];var m13 = m[2];
		var m21 = m[3];var m22 = m[4];var m23 = m[5];
		var m31 = m[6];var m32 = m[7];var m33 = m[8];
		
		det =m11 * m22 * m33 + m12 * m23 * m31 + m13 * m21 * m32 - m13 * m22 * m31 - m12 * m21 * m33 - m11 * m23 * m32;
		
		m[0] = m22 * m33 - m23 * m32;
		m[1] = -( m21 * m33 - m23 * m31 );
		m[2] = m21*m32 - m22 *m31;
		
		m[3] = -(m12* m33 - m13 * m32);
		m[4] = m11 * m33 - m13 * m31;
		m[5] = -(m11 * m32 - m12* m31);
		
		m[6] = m12 * m23 -m13* m22;
		m[7] = -(m11 * m23-m13* m21);
		m[8] =m11 * m22 -m12* m21;
		
		this.transpose().multiplyScalar( 1.0 / det );
		
		return this;
		
	},
	
	multiplyScalar: function ( s ) {

		var te = this.elements;

		te[0] *= s; te[3] *= s; te[6] *= s;
		te[1] *= s; te[4] *= s; te[7] *= s;
		te[2] *= s; te[5] *= s; te[8] *= s;

		return this;

	},

	transpose : function () {
		
		var m = this.elements;
		var t;
		
		t = m[1];m[1] = m[3];m[3] = t;
		t = m[2];m[2] = m[6];m[6] = t;
		t = m[5];m[5] = m[7];m[7] = t;
		
		
		return this;
	},
	
	setPosition : function ( dx , dy ) {
	
		var m = this.elements;
	
		m[2] = dx;
		m[5] = dy;
	
		return this;
	},
	
	clone : function () {
	
		var e = this.elements;
		
		return new Matrix3(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8] );
	
	}
	
}
function Matrix4 ( m11, m12 , m13 , m14 , m21 , m22 , m23 , m24 , m31 , m32 , m33 , m34 , m41 , m42 , m43 , m44 ) {
	
	this.elements = [];
	
	var t = this.elements;
	
	t[0] = m11; t[1] = m12; t[2] = m13; t[3] = m14;
	t[4] = m21; t[5] = m22; t[6] = m23; t[7] = m24; 
	t[8] = m31; t[9] = m32; t[10] = m33; t[11] = m34; 
	t[12] = m41; t[13] = m42; t[14] = m43; t[15] = m44; 
	
}

Matrix4.prototype = {

	constructor : Matrix4,
	
	identity : function () {
		
		var t = this.elements;
		
		t[0] = 1; t[1] = 0; t[2] = 0; t[3] = 0;
		t[4] = 0; t[5] = 1; t[6] = 0; t[7] = 0; 
		t[8] = 0; t[9] = 0; t[10] = 1; t[11] = 0; 
		t[12] = 0; t[13] = 0; t[14] = 0; t[15] = 1; 
		
		return this;
	},
	
	/* this矩阵 乘以 m ，结果存储在r中 */
	multiply : function ( r , m ) {
		
		var ae = this.elements;
		var be = m.elements;
		var re = r.elements;
		
		var a11 = ae[0], a12 = ae[1], a13 = ae[2], a14 = ae[3];
		var a21 = ae[4], a22 = ae[5], a23 = ae[6], a24 = ae[7];
		var a31 = ae[8], a32 = ae[9], a33 = ae[10], a34 = ae[11];
		var a41 = ae[12], a42 = ae[13], a43 = ae[14], a44 = ae[15];
		
		var b11 = be[0], b12 = be[1], b13 = be[2], b14 = be[3];
		var b21 = be[4], b22 = be[5], b23 = be[6], b24 = be[7];
		var b31 = be[8], b32 = be[9], b33 = be[10], b34 = be[11];
		var b41 = be[12], b42 = be[13], b43 = be[14], b44 = be[15];
		
		re[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;
		re[1] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;
		re[2] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;
		re[3] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;
		
		re[4] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;
		re[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;
		re[6] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;
		re[7] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;
		
		re[8] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;
		re[9] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;
		re[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;
		re[11] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;
		
		re[12] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;
		re[13] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;
		re[14] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;
		re[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;
		
	},
	
	setFromEuler : function ( rx , ry , rz ) {
	
		/*  the Euler order is XYZ => ( Z * Y * X )*/
		var sinX = Math.sin( rx );
		var cosX = Math.cos( rx );
		var sinY = Math.sin( ry );
		var cosY = Math.cos( ry );
		var sinZ = Math.sin( rz );
		var cosZ = Math.cos( rz );
		
		
		var m = this.elements;
		
		m[0] = cosZ * cosY;
		m[1] = cosZ * sinY * sinX - sinZ * cosX;
		m[2] = cosZ * sinY * cosX + sinX * sinX;
		m[3] = 0;
		m[4] = sinZ * cosY;
		m[5] = sinZ * sinY * sinX + cosX * cosZ;
		m[6] = sinZ * sinY * cosX - cosZ * sinX;
		m[7] = 0;
		m[8] = -sinY;
		m[9] = cosY * sinX;
		m[10] = cosY * cosX;
		m[11] = 0;
		m[12] = m[13] = m[14] = 0;
		m[15] = 1;
		

		
		return this;
		
	},
	
	transpose : function () {
		
		var m = this.elements;
		var t;
		
		t = m[1];m[1] = m[4];m[4] = t;
		t = m[2];m[2] = m[8];m[8] = t;
		t = m[6];m[6] = m[9];m[9] = t;
		
		
		t = m[3];m[3] = m[12];m[12] = t;
		t = m[7];m[7] = m[13];m[13] = t;
		t = m[11];m[11] = m[14];m[14] = t;
		
		return this;
	},
	
	setPosition : function ( dx , dy , dz ) {
	
		var m = this.elements;
	
		m[3] = dx;
		m[7] = dy;
		m[11] = dz;
		
		return this;
	}
	
}

function Vector3 ( x , y , w) {

	this.x = x || 0;
	this.y = y || 0;
	this.w = w || 1;

};

Vector3.prototype = {

	constructor : Vector3,
	
	applyMatrix : function ( m ) {
	
		var me = m.elements;
		
		var x = this.x;
		var y = this.y;
		var w = this.w;
	
		this.x = me[0] * x + me[1] * y + me[2] * w;
		this.y = me[3] * x + me[4] * y + me[5] * w;
		this.w = me[6] * x + me[7] * y + me[8] * w;
		
		return this;
		
	},
	
	getLength : function ( v ) {
	
		if ( this.w === 0 || v.w === 0 ) return ;
		
		var dx = this.x - v.x;
		var dy = this.y - v.y;
		
		return Math.sqrt( dx * dx + dy * dy );
	
	}
	
	

}

function Face ( a , b , c ,color) {
	
	this.a = a;
	this.b = b;
	this.c = c;
	
	this.depth = 0;
	
	this.color  = color || '#eeeeee';
	this.border = null;
	
	this.material = null;
};

Face.prototype = {

	constructor : Face,
	
	setMaterial : function ( texture , uv ) {
	
	
		/* 这里做贴图映射 */
		/* 思路：选最大角顶点的其余两点的任意一点，如果旋转后，最大角顶点的y值为负，则再做一个平移和旋转操作 */
		
		/* 约定 b - a 向量为x轴 ， c - a 向量为y轴 。pointA对应a点，pointB 对应b点 ， pointC 对应c点*/
		
		var  pointA , pointB , pointC,
		baseToOriginalMtx , baseToTargetMtx  , OriginalToTargetMtx , lengthAB = 0 , lengthBC = 0 , lengthCA = 0,
		rad = 0 , pivx , pivy , cvsHeight , cvsWidth , maxRadVertex , affinityMtx;
		
		
	
		pointA = new Vector3(texture.width * uv[0][0],texture.height * uv[0][1],1);
		pointB = new Vector3(texture.width * uv[1][0],texture.height * uv[1][1],1);
		pointC = new Vector3(texture.width * uv[2][0],texture.height * uv[2][1],1);
		
		baseToOriginalMtx = new Matrix3(  pointB.x - pointA.x , pointC.x - pointA.x , pointA.x , pointB.y - pointA.y , pointC.y - pointA.y , pointA.y , 0 , 0 , 1 );
		
		lengthAB = pointA.getLength( pointB ); 
		lengthBC = pointB.getLength( pointC ); 
		lengthCA = pointC.getLength( pointA ); 
	
		if (lengthAB > lengthBC && lengthAB > lengthCA ) {        
		
			// use u_a v_a
			rad = Math.atan2( pointB.y-pointA.y, pointB.x - pointA.x );
			pivx = pointA.x;
			pivy = pointA.y;
			cvsWidth = lengthAB;
			maxRadVertex = pointC;
			
		}
		else if ( lengthBC > lengthCA ) { 
		
			// use u_b v_b
			rad = Math.atan2( pointC.y-pointB.y, pointC.x-pointB.x );
			pivx = pointB.x;
			pivy = pointB.y;
			cvsWidth = lengthBC;
			maxRadVertex = pointA;
			
		}
		else {
		
			// use u_c v_c
			rad = Math.atan2( pointA.y-pointC.y, pointA.x-pointC.x );
			pivx = pointC.x;
			pivy = pointC.y;
			cvsWidth = lengthCA;
			maxRadVertex = pointB;
							
		}
		
				
		rad = -rad;
		var cosR = Math.cos( rad );
		var sinR = Math.sin( rad )
		
		affinityMtx = new Matrix3();
		
		( new Matrix3( cosR , -sinR , 0 , sinR , cosR , 0 , 0 , 0 , 1 ) ).multiply( affinityMtx , new Matrix3( 1 , 0 , -pivx , 0 ,1 , -pivy , 0 , 0 , 1) );
		
		//( new Matrix3( 1 , 0 , 1 , 0 , 1 , 1 , 0 , 0 , 1) ).multiply(affinityMtx , affinityMtx);
		
		pointA.applyMatrix( affinityMtx );
		pointB.applyMatrix( affinityMtx );
		pointC.applyMatrix( affinityMtx );
				
		if ( maxRadVertex.y < 0) {
			
			affinityMtx = new Matrix3( -1 , 0 , cvsWidth , 0 , -1 , 0 , 0 , 0 , 1 );
			
			pointA.applyMatrix( affinityMtx );
			pointB.applyMatrix( affinityMtx );
			pointC.applyMatrix( affinityMtx );
					
		}
		
		
		cvsHeight = ( pointA.y > pointB.y ) ? ( pointA.y > pointC.y ? pointA.y : pointC.y ) : ( pointB.y > pointC.y ? pointB.y : pointC.y );
			
		// 新建一个贴图
		var canvas = document.createElement( "canvas" );
		canvas.width = Math.ceil( cvsWidth );//返回大于等于数字参数的最小整数
		canvas.height = Math.ceil( cvsHeight );
	
		var ctx = canvas.getContext( "2d" );
				
		baseToTargetMtx = new Matrix3(  pointB.x - pointA.x , pointC.x - pointA.x , pointA.x , pointB.y - pointA.y , pointC.y - pointA.y , pointA.y , 0 , 0 , 1 );
			
		var baseToTargetMtxInverse = baseToTargetMtx.clone().inverse();
		
		OriginalToTargetMtx = new Matrix3();
		
		baseToTargetMtx.multiply( OriginalToTargetMtx , baseToOriginalMtx.inverse()  );
		
	
		ctx.save();
		                
		var OTTelements = OriginalToTargetMtx.elements;
		
		ctx.setTransform( OTTelements[0], OTTelements[3], OTTelements[1],OTTelements[4], OTTelements[2], OTTelements[5] );
						//x 轴     y 轴
						//0,0这两个参数表示绘制图像的左上角位置
		ctx.drawImage( texture, 0, 0);

		ctx.restore();
		
		this.material = new Material();
		
		this.material.style =  ctx.createPattern( canvas, "no-repeat" );
		 
		 
		this.material.matrix = baseToTargetMtxInverse;
		
		

		
		return this;
		
	},

	
	updateDepth : function () {
	
		/* 更新z轴深度信息 */
		this.depth = this.a.z + this.b.z + this.c.z;
	
	}
	
}
function Camera ( x , y , z , rx , ry , rz , distance ) {
	
	
	this.x = x || 0;
	this.y = y || 0;
	this.z = z || 0;
	this.rx = rx || 0;
	this.ry = ry || 0;
	this.rz = rz || 0;
	
	this.distance = distance || 500; //near
	

	this.matrixWorldInverse = new Matrix4();
	this.projectionMatrix = new Matrix4(); /* 透视投影矩阵暂时不考虑CVV裁剪 */
	
	
	this.projectionMatrix.identity(); 
	this.updateProjectionMatrix();
	
};

/* X                       
   1  0   0    0
   0  cx  -sx  0
   0  sx  cx   0   
   0  0   0    1
   
   Y                       
   cy   0   sy  0
   0    1   0   0
   -sy  0   cy  0   
   0    0   0   1
   
   Z                        
   cz  -sz   0  0
   sz  cz    0  0
   0   0     1  0  
   0   0     0  1
   
   Euler order is 'XYZ'
 */
Camera.prototype = {

	constructor : Camera,
	
	update :  function () {
	
                                                                        /* 旋转矩阵的转置即为矩阵的逆 */
		this.matrixWorldInverse.setFromEuler( this.rx , this.ry , this.rz ).transpose();//order : 'XYZ'  => Z * Y * X
		
		var tra = new Matrix4().identity().setPosition( -this.x , -this.y , -this.z );
		
		this.matrixWorldInverse.multiply( this.matrixWorldInverse , tra );
		
	},

	setDistance : function ( distance ) {

		this.distance = distance;
		
		this.updateProjectionMatrix();

	},

	updateProjectionMatrix : function () {

		/* 根据distance等信息更新投影矩阵 */
		
		var projectionMatrix = this.projectionMatrix.elements;
		
		projectionMatrix[ 0 ] = projectionMatrix[ 5 ] = this.distance;
		
		
	}
}

function Vertex ( x , y , z ) {

	this.x = x || 0; // 世界坐标系中的位置
	this.y = y || 0;
	this.z = z || 0;
	
	this.sx = 0;     // 在屏幕上投影后的位置
	this.sy = 0;
	this.depth = 0;
		
};

Vertex.prototype = {

	constructor : Vertex,
	
	applyMatrix4 : function ( m ) {
	
		var m = m.elements;
	
		var x = this.x;
		var y = this.y;
		var z = this.z;
		
		
		this.x = m[0] * x + m[1] * y + m[2] * z + m[3];
		this.y = m[4] * x + m[5] * y + m[6] * z + m[7];
		this.depth = this.z = m[8] * x + m[9] * y + m[10] * z + m[11];
		
		
		
		return this;
	
	},
	
	applyProjection : function( m ) {
	
		/* 这里做投影变换，变换到屏幕中 */
		var t = this.clone().applyMatrix4( m );
		
		//alert(t.elements);
		
		this.depth = t.z;
		
		
		this.sx = t.x/this.depth;
		this.sy = t.y/this.depth;
		
		
		return this;
	
	},
	
	draw : function ( ctx ) {
	
		ctx.fillStyle="#FF0000";
		ctx.beginPath();
		ctx.arc( this.sx , this.sy , 15 , 0 , Math.PI*2 , true );
		ctx.closePath();
		ctx.fill();
	
	},
	
	clone : function () {
	
		return new Vertex( this.x , this.y , this.z );
	
	}
	
}


function Timer ( fps )  { /* 单例模式 */

	this.count = 0;
	
	this.fps = fps || 30;
	
	this.actions = []; /* 元素为动画执行的方法的引用 */
	
	this.timer = undefined;
	
	this.state = Timer.STOP;

};

Timer.STOP = 'stop';
Timer.RUNNING = 'running';

Timer.prototype = {

	constructor : Timer,
	
	start : function ( ) {
	
		if ( this.state === Timer.RUNNING ) return;
		
		var interval = 1000 / this.fps;
		
		var f = this.update;

		var actions = this.actions;
		//var _self = this;
		this.timer =  setInterval( function ( ) { f( actions); } , interval );
		//this.timer =  setInterval( function ( ) { _self.update.call( _self) } , interval );
		this.state = Timer.RUNNING;
	},
	
	stop : function () {
	
		clearInterval( this.timer );
		
		this.state = Timer.STOP;
	
	},
	
	update : function( actions) {
	
		//var actions = this.actions;
	
		for ( var i = 0; i < actions.length; i++ ) {
			
			actions[i].call( this );
			
		}
	
	},
	
	addAction : function ( f ) {
	
		if ( f === undefined ) return;
	
		var actions = this.actions;
		
		if ( actions.indexOf( f ) === -1 ) {
		
			actions.push( f );
		
		}
		
	},
	
	hasAction : function ( f ) {
	
		if ( f === undefined ) return;
		
		var actions = this.actions;
		
		if ( actions.indexOf( f ) !== -1 ) {
		
			return true;
		
		}
		
		return false;
		
	},
	
	removeAction : function ( f ) {
	
		if ( f === undefined ) return;
	
		var actions = this.actions;
		
		var index = actions.indexOf( f );
		
		if ( index !== -1 ) {
		
			actions.splice( index , 1 );
		
		}
	
	}
}











var mesh;var faces=[],vertices=[];
var meshData = {

verticesrc :[ [-65,-124,50],[-78,-106,90],[-68,-91,70],[-45,-117,-30],[-69,-147,50],[-43,-144,-30],[-68,-177,60],[-42,-174,-30],[-23,-180,-30],[-14,-150,-30],[0,-180,-30],[6,-152,-40],[23,-178,-30],[29,-149,-40],[46,-175,-30],[47,-144,-40],[68,-173,-30],[69,-137,-40],[-52,-199,60],[-34,-208,50],[-21,-195,-20],[-15,-215,50],[-3,-197,-20],[11,-220,60],[20,-198,-20],[37,-216,50],[42,-192,-20],[60,-209,50],[62,-188,-20],[77,-207,70],[85,-185,60],[-17,-131,-40],[-1,-127,-30],[18,-127,-40],[39,-127,-40],[55,-119,-30],[92,-160,60],[85,-143,0],[99,-141,70],[86,-120,70],[79,-102,40],[95,-104,70],[98,-89,70],[82,-78,50],[-29,-112,-30],[-12,-107,-40],[9,-105,-30],[26,-104,-40],[43,-111,-40],[65,-108,-30],[16,-91,-20],[-1,-90,-20],[9,-73,-50],[28,-78,-10],[-9,-76,-10],[-31,-95,-10],[-46,-100,-10],[-11,-89,-10],[-33,-82,-10],[-51,-80,-10],[47,-92,-20],[64,-90,-10],[29,-92,-20],[38,-81,-10],[55,-79,-10],[70,-71,0],[10,-62,-20],[29,-61,-20],[-21,-64,0],[-42,-59,0],[51,-61,-10],[-9,-52,-20],[25,-51,-20],[47,-45,-10],[-30,-40,0],[9,-42,-20],[-7,-25,-10],[36,-27,-10],[11,-22,0],[15,-6,0],[37,-9,30],[-7,-6,20],[-57,-59,60],[-49,-39,40],[-30,-21,20],[83,-61,60],[77,-45,60],[71,-30,60],[57,-20,50],[-39,7,70],[-17,16,60],[7,22,70],[26,19,40],[49,11,50],[69,8,40],[83,-11,50],[95,-37,50],[-54,-11,50],[-73,-31,70],[-88,-52,70],[-98,-70,80],[-105,-82,100],[101,-58,50],[116,-84,60],[109,-96,90],[-137,-66,130],[-124,-55,100],[-107,-21,80],[-80,-3,70],[-64,25,70],[-46,41,70],[-13,55,100],[8,56,80],[37,51,60],[61,37,50],[84,19,40],[107,-9,40],[119,-36,50],[131,-60,50],[132,-86,90],[-57,87,40],[11,90,80],[50,83,40],[9,124,90],[-42,142,60],[61,133,50],[11,156,70],[-39,172,60],[66,175,30],[15,182,80],[17,225,80],[-42,215,90],[71,223,110],[64,62,40],[78,48,30],[86,103,20],[99,87,20],[100,38,20],[112,18,20],[141,16,20],[164,-10,30],[171,-44,60],[177,-60,90],[87,141,20],[113,78,10],[129,66,10],[147,56,10],[169,45,20],[187,19,20],[207,-6,40],[211,-55,100],[244,-45,120],[245,-6,100],[230,26,60],[-71,60,50],[-93,39,50],[-118,19,60],[-140,-1,70],[-159,-28,100],[-157,-56,140],[-190,-51,150],[-221,-39,180],[-193,-20,150],[-240,-25,180],[-244,41,180],[-167,-7,110],[-138,43,60],[-119,56,50],[-96,71,40],[-82,92,40],[-66,132,50],[139,140,20],[114,179,50],[-109,167,60],[-129,134,50],[151,113,10],[167,100,20],[180,86,30],[198,75,30],[219,58,30],[-147,113,50],[-177,91,70],[-206,68,90],[-223,46,110],[-205,90,110],[-235,81,150],[-185,126,110],[-154,147,80],[-130,164,100],[172,154,30],[158,178,50],[193,133,40],[202,114,50],[213,95,50],[229,80,60],[239,50,90]],
facesrc :[ [1,2,3],[1,3,4],[1,4,5],[4,5,6],[5,6,7],[6,7,8],[6,8,9],[6,9,10],[9,10,11],[10,11,12],[11,12,13],[12,13,14],[13,14,15],[14,15,16],[15,16,17],[16,17,18],[7,8,19],[8,19,20],[8,20,21],[20,21,22],[21,22,23],[22,23,24],[23,24,25],[24,25,26],[25,26,27],[26,27,28],[27,28,29],[28,29,30],[29,30,31],[29,31,17],[27,29,15],[29,15,17],[23,25,11],[25,11,13],[25,13,27],[13,27,15],[21,23,11],[21,11,9],[8,20,9],[20,9,21],[20,9,19],[9,19,8],[6,10,32],[10,32,33],[10,33,12],[33,12,34],[12,34,14],[34,14,35],[14,35,16],[35,16,36],[16,36,18],[31,17,37],[17,37,38],[17,38,18],[37,38,39],[38,39,40],[38,18,40],[18,40,36],[40,36,41],[40,41,42],[41,42,43],[41,43,44],[6,32,4],[32,4,45],[32,45,46],[32,33,46],[33,46,47],[33,47,34],[47,34,48],[34,48,35],[48,35,49],[35,49,36],[49,36,50],[36,50,40],[50,40,41],[47,48,51],[46,47,52],[47,52,53],[47,51,53],[51,53,54],[52,53,55],[4,45,56],[45,56,46],[4,56,57],[3,4,57],[56,46,58],[46,52,58],[56,57,59],[56,59,58],[57,59,60],[57,60,3],[49,50,61],[50,61,62],[50,62,41],[49,61,63],[48,51,63],[48,49,63],[61,63,64],[63,64,54],[63,54,51],[61,64,65],[61,65,62],[62,41,44],[65,62,66],[62,66,44],[53,55,67],[53,54,67],[54,67,68],[54,68,64],[55,67,69],[59,58,55],[59,55,69],[59,69,70],[59,60,70],[68,64,71],[65,66,71],[64,71,65],[67,69,72],[67,68,73],[67,72,73],[68,73,74],[68,74,71],[69,72,75],[69,75,70],[72,73,76],[72,75,76],[73,76,74],[75,76,77],[76,74,78],[76,77,79],[76,79,78],[79,78,80],[78,80,81],[77,79,80],[77,80,82],[52,55,58],[60,70,83],[60,3,83],[70,83,84],[70,84,75],[84,75,85],[75,85,77],[85,77,82],[43,44,86],[44,86,66],[86,66,87],[66,87,71],[87,71,88],[71,88,74],[88,74,89],[74,89,78],[89,78,81],[85,82,90],[82,90,91],[80,82,92],[80,81,93],[89,81,94],[88,89,95],[80,92,93],[81,93,94],[89,94,95],[88,95,96],[87,88,97],[82,91,92],[85,90,98],[84,85,98],[84,98,99],[83,84,99],[83,99,100],[3,83,101],[83,101,100],[3,101,102],[3,102,2],[88,97,96],[87,97,103],[87,103,86],[103,86,104],[86,104,43],[104,43,105],[43,105,42],[101,102,106],[101,106,107],[101,107,100],[107,100,108],[100,108,99],[108,99,109],[99,109,98],[109,98,110],[98,110,90],[110,90,111],[90,111,91],[111,91,112],[91,112,92],[112,92,113],[92,113,93],[113,93,114],[93,114,94],[114,94,115],[94,115,95],[115,95,116],[95,116,96],[116,96,117],[96,117,97],[117,97,118],[97,118,103],[118,103,119],[103,119,104],[119,104,120],[104,120,105],[111,112,121],[112,121,122],[113,114,122],[114,122,123],[121,122,124],[121,124,125],[122,124,126],[122,126,123],[124,125,127],[125,127,128],[124,127,126],[127,126,129],[127,129,130],[127,128,130],[128,130,131],[128,131,132],[129,130,131],[129,131,133],[114,115,134],[114,123,134],[115,116,135],[115,134,135],[123,134,136],[134,135,137],[116,135,138],[116,117,138],[117,138,139],[117,118,140],[117,139,140],[118,140,141],[118,119,141],[119,141,142],[119,120,142],[120,142,143],[134,137,136],[123,136,126],[136,126,144],[135,138,145],[138,139,146],[139,140,147],[140,141,148],[141,142,149],[142,143,150],[143,150,151],[150,151,152],[150,152,153],[150,153,154],[142,150,149],[141,149,148],[140,148,147],[139,147,146],[138,146,145],[135,137,145],[126,144,129],[111,121,155],[110,111,155],[110,155,156],[109,110,156],[109,156,157],[108,109,157],[108,157,158],[107,108,158],[107,158,159],[106,107,159],[106,159,160],[159,160,161],[159,161,162],[159,162,163],[162,163,164],[163,164,165],[159,163,166],[159,166,158],[112,122,113],[150,149,154],[157,158,167],[157,167,168],[157,168,156],[168,156,169],[156,169,155],[169,155,170],[155,170,121],[170,121,171],[121,171,125],[171,125,128],[137,136,172],[136,144,172],[144,172,173],[144,129,173],[129,173,133],[170,171,174],[171,128,174],[128,174,132],[169,170,175],[170,175,174],[137,145,176],[146,145,177],[147,146,178],[148,147,179],[149,148,180],[149,154,180],[148,180,179],[147,179,178],[146,178,177],[145,177,176],[137,176,172],[168,169,181],[167,168,182],[158,167,183],[166,158,184],[163,166,184],[163,184,165],[158,184,183],[167,183,182],[168,182,181],[169,181,175],[183,182,185],[184,183,186],[184,165,186],[183,186,185],[182,185,187],[182,187,181],[187,181,188],[181,188,175],[188,175,189],[175,189,174],[176,172,190],[172,173,191],[173,133,191],[172,191,190],[176,190,192],[177,176,192],[177,192,193],[178,177,193],[178,193,194],[179,178,194],[180,179,195],[179,195,194],[180,195,196],[180,196,154],[196,154,153]],
uvsrc : [[0.37,0.252,0.344,0.288,0.364,0.318],[0.37,0.252,0.364,0.318,0.41,0.266],[0.37,0.252,0.41,0.266,0.362,0.206],[0.41,0.266,0.362,0.206,0.414,0.212],[0.362,0.206,0.414,0.212,0.364,0.146],[0.414,0.212,0.364,0.146,0.416,0.152],[0.414,0.212,0.416,0.152,0.454,0.14],[0.414,0.212,0.454,0.14,0.472,0.2],[0.454,0.14,0.472,0.2,0.5,0.14],[0.472,0.2,0.5,0.14,0.512,0.196],[0.5,0.14,0.512,0.196,0.546,0.144],[0.512,0.196,0.546,0.144,0.558,0.202],[0.546,0.144,0.558,0.202,0.592,0.15],[0.558,0.202,0.592,0.15,0.594,0.212],[0.592,0.15,0.594,0.212,0.636,0.154],[0.594,0.212,0.636,0.154,0.638,0.226],[0.364,0.146,0.416,0.152,0.396,0.102],[0.416,0.152,0.396,0.102,0.432,0.084],[0.416,0.152,0.432,0.084,0.458,0.11],[0.432,0.084,0.458,0.11,0.47,0.07],[0.458,0.11,0.47,0.07,0.494,0.106],[0.47,0.07,0.494,0.106,0.522,0.06],[0.494,0.106,0.522,0.06,0.54,0.104],[0.522,0.06,0.54,0.104,0.574,0.068],[0.54,0.104,0.574,0.068,0.584,0.116],[0.574,0.068,0.584,0.116,0.62,0.082],[0.584,0.116,0.62,0.082,0.624,0.124],[0.62,0.082,0.624,0.124,0.654,0.086],[0.624,0.124,0.654,0.086,0.67,0.13],[0.624,0.124,0.67,0.13,0.636,0.154],[0.584,0.116,0.624,0.124,0.592,0.15],[0.624,0.124,0.592,0.15,0.636,0.154],[0.494,0.106,0.54,0.104,0.5,0.14],[0.54,0.104,0.5,0.14,0.546,0.144],[0.54,0.104,0.546,0.144,0.584,0.116],[0.546,0.144,0.584,0.116,0.592,0.15],[0.458,0.11,0.494,0.106,0.5,0.14],[0.458,0.11,0.5,0.14,0.454,0.14],[0.416,0.152,0.432,0.084,0.454,0.14],[0.432,0.084,0.454,0.14,0.458,0.11],[0.432,0.084,0.454,0.14,0.396,0.102],[0.454,0.14,0.396,0.102,0.416,0.152],[0.414,0.212,0.472,0.2,0.466,0.238],[0.472,0.2,0.466,0.238,0.498,0.246],[0.472,0.2,0.498,0.246,0.512,0.196],[0.498,0.246,0.512,0.196,0.536,0.246],[0.512,0.196,0.536,0.246,0.558,0.202],[0.536,0.246,0.558,0.202,0.578,0.246],[0.558,0.202,0.578,0.246,0.594,0.212],[0.578,0.246,0.594,0.212,0.61,0.262],[0.594,0.212,0.61,0.262,0.638,0.226],[0.67,0.13,0.636,0.154,0.684,0.18],[0.636,0.154,0.684,0.18,0.67,0.214],[0.636,0.154,0.67,0.214,0.638,0.226],[0.684,0.18,0.67,0.214,0.698,0.218],[0.67,0.214,0.698,0.218,0.672,0.26],[0.67,0.214,0.638,0.226,0.672,0.26],[0.638,0.226,0.672,0.26,0.61,0.262],[0.672,0.26,0.61,0.262,0.658,0.296],[0.672,0.26,0.658,0.296,0.69,0.292],[0.658,0.296,0.69,0.292,0.696,0.322],[0.658,0.296,0.696,0.322,0.664,0.344],[0.414,0.212,0.466,0.238,0.41,0.266],[0.466,0.238,0.41,0.266,0.442,0.276],[0.466,0.238,0.442,0.276,0.476,0.286],[0.466,0.238,0.498,0.246,0.476,0.286],[0.498,0.246,0.476,0.286,0.518,0.29],[0.498,0.246,0.518,0.29,0.536,0.246],[0.518,0.29,0.536,0.246,0.552,0.292],[0.536,0.246,0.552,0.292,0.578,0.246],[0.552,0.292,0.578,0.246,0.586,0.278],[0.578,0.246,0.586,0.278,0.61,0.262],[0.586,0.278,0.61,0.262,0.63,0.284],[0.61,0.262,0.63,0.284,0.672,0.26],[0.63,0.284,0.672,0.26,0.658,0.296],[0.518,0.29,0.552,0.292,0.532,0.318],[0.476,0.286,0.518,0.29,0.498,0.32],[0.518,0.29,0.498,0.32,0.518,0.354],[0.518,0.29,0.532,0.318,0.518,0.354],[0.532,0.318,0.518,0.354,0.556,0.344],[0.498,0.32,0.518,0.354,0.482,0.348],[0.41,0.266,0.442,0.276,0.438,0.31],[0.442,0.276,0.438,0.31,0.476,0.286],[0.41,0.266,0.438,0.31,0.408,0.3],[0.364,0.318,0.41,0.266,0.408,0.3],[0.438,0.31,0.476,0.286,0.478,0.322],[0.476,0.286,0.498,0.32,0.478,0.322],[0.438,0.31,0.408,0.3,0.434,0.336],[0.438,0.31,0.434,0.336,0.478,0.322],[0.408,0.3,0.434,0.336,0.398,0.34],[0.408,0.3,0.398,0.34,0.364,0.318],[0.586,0.278,0.63,0.284,0.594,0.316],[0.63,0.284,0.594,0.316,0.628,0.32],[0.63,0.284,0.628,0.32,0.658,0.296],[0.586,0.278,0.594,0.316,0.558,0.316],[0.552,0.292,0.532,0.318,0.558,0.316],[0.552,0.292,0.586,0.278,0.558,0.316],[0.594,0.316,0.558,0.316,0.576,0.338],[0.558,0.316,0.576,0.338,0.556,0.344],[0.558,0.316,0.556,0.344,0.532,0.318],[0.594,0.316,0.576,0.338,0.61,0.342],[0.594,0.316,0.61,0.342,0.628,0.32],[0.628,0.32,0.658,0.296,0.664,0.344],[0.61,0.342,0.628,0.32,0.64,0.358],[0.628,0.32,0.64,0.358,0.664,0.344],[0.518,0.354,0.482,0.348,0.52,0.376],[0.518,0.354,0.556,0.344,0.52,0.376],[0.556,0.344,0.52,0.376,0.558,0.378],[0.556,0.344,0.558,0.378,0.576,0.338],[0.482,0.348,0.52,0.376,0.458,0.372],[0.434,0.336,0.478,0.322,0.482,0.348],[0.434,0.336,0.482,0.348,0.458,0.372],[0.434,0.336,0.458,0.372,0.416,0.382],[0.434,0.336,0.398,0.34,0.416,0.382],[0.558,0.378,0.576,0.338,0.602,0.378],[0.61,0.342,0.64,0.358,0.602,0.378],[0.576,0.338,0.602,0.378,0.61,0.342],[0.52,0.376,0.458,0.372,0.482,0.396],[0.52,0.376,0.558,0.378,0.55,0.398],[0.52,0.376,0.482,0.396,0.55,0.398],[0.558,0.378,0.55,0.398,0.594,0.41],[0.558,0.378,0.594,0.41,0.602,0.378],[0.458,0.372,0.482,0.396,0.44,0.42],[0.458,0.372,0.44,0.42,0.416,0.382],[0.482,0.396,0.55,0.398,0.518,0.416],[0.482,0.396,0.44,0.42,0.518,0.416],[0.55,0.398,0.518,0.416,0.594,0.41],[0.44,0.42,0.518,0.416,0.486,0.45],[0.518,0.416,0.594,0.41,0.572,0.446],[0.518,0.416,0.486,0.45,0.522,0.456],[0.518,0.416,0.522,0.456,0.572,0.446],[0.522,0.456,0.572,0.446,0.53,0.488],[0.572,0.446,0.53,0.488,0.574,0.482],[0.486,0.45,0.522,0.456,0.53,0.488],[0.486,0.45,0.53,0.488,0.486,0.488],[0.498,0.32,0.482,0.348,0.478,0.322],[0.398,0.34,0.416,0.382,0.386,0.382],[0.398,0.34,0.364,0.318,0.386,0.382],[0.416,0.382,0.386,0.382,0.402,0.422],[0.416,0.382,0.402,0.422,0.44,0.42],[0.402,0.422,0.44,0.42,0.44,0.458],[0.44,0.42,0.44,0.458,0.486,0.45],[0.44,0.458,0.486,0.45,0.486,0.488],[0.696,0.322,0.664,0.344,0.666,0.378],[0.664,0.344,0.666,0.378,0.64,0.358],[0.666,0.378,0.64,0.358,0.654,0.41],[0.64,0.358,0.654,0.41,0.602,0.378],[0.654,0.41,0.602,0.378,0.642,0.44],[0.602,0.378,0.642,0.44,0.594,0.41],[0.642,0.44,0.594,0.41,0.614,0.46],[0.594,0.41,0.614,0.46,0.572,0.446],[0.614,0.46,0.572,0.446,0.574,0.482],[0.44,0.458,0.486,0.488,0.422,0.514],[0.486,0.488,0.422,0.514,0.466,0.532],[0.53,0.488,0.486,0.488,0.514,0.544],[0.53,0.488,0.574,0.482,0.552,0.538],[0.614,0.46,0.574,0.482,0.598,0.522],[0.642,0.44,0.614,0.46,0.638,0.516],[0.53,0.488,0.514,0.544,0.552,0.538],[0.574,0.482,0.552,0.538,0.598,0.522],[0.614,0.46,0.598,0.522,0.638,0.516],[0.642,0.44,0.638,0.516,0.666,0.478],[0.654,0.41,0.642,0.44,0.69,0.426],[0.486,0.488,0.466,0.532,0.514,0.544],[0.44,0.458,0.422,0.514,0.392,0.478],[0.402,0.422,0.44,0.458,0.392,0.478],[0.402,0.422,0.392,0.478,0.354,0.438],[0.386,0.382,0.402,0.422,0.354,0.438],[0.386,0.382,0.354,0.438,0.324,0.396],[0.364,0.318,0.386,0.382,0.304,0.36],[0.386,0.382,0.304,0.36,0.324,0.396],[0.364,0.318,0.304,0.36,0.29,0.336],[0.364,0.318,0.29,0.336,0.344,0.288],[0.642,0.44,0.69,0.426,0.666,0.478],[0.654,0.41,0.69,0.426,0.702,0.384],[0.654,0.41,0.702,0.384,0.666,0.378],[0.702,0.384,0.666,0.378,0.732,0.332],[0.666,0.378,0.732,0.332,0.696,0.322],[0.732,0.332,0.696,0.322,0.718,0.308],[0.696,0.322,0.718,0.308,0.69,0.292],[0.304,0.36,0.29,0.336,0.226,0.368],[0.304,0.36,0.226,0.368,0.252,0.39],[0.304,0.36,0.252,0.39,0.324,0.396],[0.252,0.39,0.324,0.396,0.286,0.458],[0.324,0.396,0.286,0.458,0.354,0.438],[0.286,0.458,0.354,0.438,0.34,0.494],[0.354,0.438,0.34,0.494,0.392,0.478],[0.34,0.494,0.392,0.478,0.372,0.55],[0.392,0.478,0.372,0.55,0.422,0.514],[0.372,0.55,0.422,0.514,0.408,0.582],[0.422,0.514,0.408,0.582,0.466,0.532],[0.408,0.582,0.466,0.532,0.474,0.61],[0.466,0.532,0.474,0.61,0.514,0.544],[0.474,0.61,0.514,0.544,0.516,0.612],[0.514,0.544,0.516,0.612,0.552,0.538],[0.516,0.612,0.552,0.538,0.574,0.602],[0.552,0.538,0.574,0.602,0.598,0.522],[0.574,0.602,0.598,0.522,0.622,0.574],[0.598,0.522,0.622,0.574,0.638,0.516],[0.622,0.574,0.638,0.516,0.668,0.538],[0.638,0.516,0.668,0.538,0.666,0.478],[0.668,0.538,0.666,0.478,0.714,0.482],[0.666,0.478,0.714,0.482,0.69,0.426],[0.714,0.482,0.69,0.426,0.738,0.428],[0.69,0.426,0.738,0.428,0.702,0.384],[0.738,0.428,0.702,0.384,0.762,0.38],[0.702,0.384,0.762,0.38,0.732,0.332],[0.762,0.38,0.732,0.332,0.764,0.328],[0.732,0.332,0.764,0.328,0.718,0.308],[0.408,0.582,0.474,0.61,0.386,0.674],[0.474,0.61,0.386,0.674,0.522,0.68],[0.516,0.612,0.574,0.602,0.522,0.68],[0.574,0.602,0.522,0.68,0.6,0.666],[0.386,0.674,0.522,0.68,0.518,0.748],[0.386,0.674,0.518,0.748,0.416,0.784],[0.522,0.68,0.518,0.748,0.622,0.766],[0.522,0.68,0.622,0.766,0.6,0.666],[0.518,0.748,0.416,0.784,0.522,0.812],[0.416,0.784,0.522,0.812,0.422,0.844],[0.518,0.748,0.522,0.812,0.622,0.766],[0.522,0.812,0.622,0.766,0.632,0.85],[0.522,0.812,0.632,0.85,0.53,0.864],[0.522,0.812,0.422,0.844,0.53,0.864],[0.422,0.844,0.53,0.864,0.534,0.95],[0.422,0.844,0.534,0.95,0.416,0.93],[0.632,0.85,0.53,0.864,0.534,0.95],[0.632,0.85,0.534,0.95,0.642,0.946],[0.574,0.602,0.622,0.574,0.628,0.624],[0.574,0.602,0.6,0.666,0.628,0.624],[0.622,0.574,0.668,0.538,0.656,0.596],[0.622,0.574,0.628,0.624,0.656,0.596],[0.6,0.666,0.628,0.624,0.672,0.706],[0.628,0.624,0.656,0.596,0.698,0.674],[0.668,0.538,0.656,0.596,0.7,0.576],[0.668,0.538,0.714,0.482,0.7,0.576],[0.714,0.482,0.7,0.576,0.724,0.536],[0.714,0.482,0.738,0.428,0.782,0.532],[0.714,0.482,0.724,0.536,0.782,0.532],[0.738,0.428,0.782,0.532,0.828,0.48],[0.738,0.428,0.762,0.38,0.828,0.48],[0.762,0.38,0.828,0.48,0.842,0.412],[0.762,0.38,0.764,0.328,0.842,0.412],[0.764,0.328,0.842,0.412,0.854,0.38],[0.628,0.624,0.698,0.674,0.672,0.706],[0.6,0.666,0.672,0.706,0.622,0.766],[0.672,0.706,0.622,0.766,0.674,0.782],[0.656,0.596,0.7,0.576,0.726,0.656],[0.7,0.576,0.724,0.536,0.758,0.632],[0.724,0.536,0.782,0.532,0.794,0.612],[0.782,0.532,0.828,0.48,0.838,0.59],[0.828,0.48,0.842,0.412,0.874,0.538],[0.842,0.412,0.854,0.38,0.914,0.488],[0.854,0.38,0.914,0.488,0.922,0.39],[0.914,0.488,0.922,0.39,0.988,0.41],[0.914,0.488,0.988,0.41,0.99,0.488],[0.914,0.488,0.99,0.488,0.96,0.552],[0.842,0.412,0.914,0.488,0.874,0.538],[0.828,0.48,0.874,0.538,0.838,0.59],[0.782,0.532,0.838,0.59,0.794,0.612],[0.724,0.536,0.794,0.612,0.758,0.632],[0.7,0.576,0.758,0.632,0.726,0.656],[0.656,0.596,0.698,0.674,0.726,0.656],[0.622,0.766,0.674,0.782,0.632,0.85],[0.408,0.582,0.386,0.674,0.358,0.62],[0.372,0.55,0.408,0.582,0.358,0.62],[0.372,0.55,0.358,0.62,0.314,0.578],[0.34,0.494,0.372,0.55,0.314,0.578],[0.34,0.494,0.314,0.578,0.264,0.538],[0.286,0.458,0.34,0.494,0.264,0.538],[0.286,0.458,0.264,0.538,0.22,0.498],[0.252,0.39,0.286,0.458,0.22,0.498],[0.252,0.39,0.22,0.498,0.182,0.444],[0.226,0.368,0.252,0.39,0.182,0.444],[0.226,0.368,0.182,0.444,0.186,0.388],[0.182,0.444,0.186,0.388,0.12,0.398],[0.182,0.444,0.12,0.398,0.058,0.422],[0.182,0.444,0.058,0.422,0.114,0.46],[0.058,0.422,0.114,0.46,0.02,0.45],[0.114,0.46,0.02,0.45,0.012,0.582],[0.182,0.444,0.114,0.46,0.166,0.486],[0.182,0.444,0.166,0.486,0.22,0.498],[0.474,0.61,0.522,0.68,0.516,0.612],[0.914,0.488,0.874,0.538,0.96,0.552],[0.264,0.538,0.22,0.498,0.224,0.586],[0.264,0.538,0.224,0.586,0.262,0.612],[0.264,0.538,0.262,0.612,0.314,0.578],[0.262,0.612,0.314,0.578,0.308,0.642],[0.314,0.578,0.308,0.642,0.358,0.62],[0.308,0.642,0.358,0.62,0.336,0.684],[0.358,0.62,0.336,0.684,0.386,0.674],[0.336,0.684,0.386,0.674,0.368,0.764],[0.386,0.674,0.368,0.764,0.416,0.784],[0.368,0.764,0.416,0.784,0.422,0.844],[0.698,0.674,0.672,0.706,0.778,0.78],[0.672,0.706,0.674,0.782,0.778,0.78],[0.674,0.782,0.778,0.78,0.728,0.858],[0.674,0.782,0.632,0.85,0.728,0.858],[0.632,0.85,0.728,0.858,0.642,0.946],[0.336,0.684,0.368,0.764,0.282,0.834],[0.368,0.764,0.422,0.844,0.282,0.834],[0.422,0.844,0.282,0.834,0.416,0.93],[0.308,0.642,0.336,0.684,0.242,0.768],[0.336,0.684,0.242,0.768,0.282,0.834],[0.698,0.674,0.726,0.656,0.802,0.726],[0.758,0.632,0.726,0.656,0.834,0.7],[0.794,0.612,0.758,0.632,0.86,0.672],[0.838,0.59,0.794,0.612,0.896,0.65],[0.874,0.538,0.838,0.59,0.938,0.616],[0.874,0.538,0.96,0.552,0.938,0.616],[0.838,0.59,0.938,0.616,0.896,0.65],[0.794,0.612,0.896,0.65,0.86,0.672],[0.758,0.632,0.86,0.672,0.834,0.7],[0.726,0.656,0.834,0.7,0.802,0.726],[0.698,0.674,0.802,0.726,0.778,0.78],[0.262,0.612,0.308,0.642,0.206,0.726],[0.224,0.586,0.262,0.612,0.146,0.682],[0.22,0.498,0.224,0.586,0.088,0.636],[0.166,0.486,0.22,0.498,0.054,0.592],[0.114,0.46,0.166,0.486,0.054,0.592],[0.114,0.46,0.054,0.592,0.012,0.582],[0.22,0.498,0.054,0.592,0.088,0.636],[0.224,0.586,0.088,0.636,0.146,0.682],[0.262,0.612,0.146,0.682,0.206,0.726],[0.308,0.642,0.206,0.726,0.242,0.768],[0.088,0.636,0.146,0.682,0.09,0.68],[0.054,0.592,0.088,0.636,0.03,0.662],[0.054,0.592,0.012,0.582,0.03,0.662],[0.088,0.636,0.03,0.662,0.09,0.68],[0.146,0.682,0.09,0.68,0.13,0.752],[0.146,0.682,0.13,0.752,0.206,0.726],[0.13,0.752,0.206,0.726,0.192,0.794],[0.206,0.726,0.192,0.794,0.242,0.768],[0.192,0.794,0.242,0.768,0.24,0.828],[0.242,0.768,0.24,0.828,0.282,0.834],[0.802,0.726,0.778,0.78,0.844,0.808],[0.778,0.78,0.728,0.858,0.816,0.856],[0.728,0.858,0.642,0.946,0.816,0.856],[0.778,0.78,0.816,0.856,0.844,0.808],[0.802,0.726,0.844,0.808,0.886,0.766],[0.834,0.7,0.802,0.726,0.886,0.766],[0.834,0.7,0.886,0.766,0.904,0.728],[0.86,0.672,0.834,0.7,0.904,0.728],[0.86,0.672,0.904,0.728,0.926,0.69],[0.896,0.65,0.86,0.672,0.926,0.69],[0.938,0.616,0.896,0.65,0.958,0.66],[0.896,0.65,0.958,0.66,0.926,0.69],[0.938,0.616,0.958,0.66,0.978,0.6],[0.938,0.616,0.978,0.6,0.96,0.552],[0.978,0.6,0.96,0.552,0.99,0.488]]



}



var timer = new Timer(30);
window.onload = function () {
	
	var l = meshData.uvsrc.length;

	for( var i = 0;i<l;i++){

	
	var e0 = meshData.uvsrc[i][0];
	var e1 = meshData.uvsrc[i][1];
	var e2 = meshData.uvsrc[i][2];
	var e3 = meshData.uvsrc[i][3];
	var e4 = meshData.uvsrc[i][4];
	var e5 = meshData.uvsrc[i][5];
	
	meshData.uvsrc[i]=[];
	meshData.uvsrc[i][0] = [e0,e1];
	meshData.uvsrc[i][1] = [e2,e3];
	meshData.uvsrc[i][2] = [e4,e5];
	
	}




	
	
	var canvas3D = document.getElementById('myCanvas');

	canvas3D.width = document.body.clientWidth - 500;
	canvas3D.height = 500;
	/****控制摄像机转动*************************************************/
	var moveHandle
	EventUtil.addListener(canvas3D , "mousedown" , function (e) {
	
		
		var old_x = e.offsetX;
		var old_y = e.offsetY;
	
		EventUtil.addListener(canvas3D , "mousemove" , moveHandle = function (e) {
		
			var d_ry = ( e.offsetX - old_x ) / 180;
			var d_rx = ( e.offsetY - old_y ) / 180;
			
			camera.ry += d_ry;
			//camera.rx += d_rx;
			camera.ry = camera.ry%(Math.PI*2);
			//camera.rx = camera.rx%(Math.PI*2);
			
			camera.y = ((500*Math.sqrt(2))*Math.sin(camera.rx));
			
			camera.x = -((500*Math.sqrt(2)*Math.cos(camera.rx))*Math.sin(camera.ry));
			camera.z = -((500*Math.sqrt(2)*Math.cos(camera.rx))*Math.cos(camera.ry));
			
			old_x = e.offsetX;
			old_y = e.offsetY;
			
		
		});
		
		var upHandle;
		var outHandle;
		EventUtil.addListener(canvas3D , "mouseup" , upHandle = function (e) {
		
			EventUtil.removeListener(canvas3D , "mouseup" , upHandle);
			EventUtil.removeListener(canvas3D , "mousemove" , moveHandle);
			
		
		});
		EventUtil.addListener(canvas3D , "mouseout" , outHandle = function (e) {
		
			EventUtil.removeListener(canvas3D , "mouseout" , outHandle);
			EventUtil.removeListener(canvas3D , "mousemove" , moveHandle);
			
		
		});
	
	});
	
	
	
	var renderer =  new Renderer(canvas3D);
			
	var camera = new Camera();

	
	
	camera.ry = -Math.PI/4;
	
	camera.x = -((500*Math.sqrt(2))*Math.sin(camera.ry));
	camera.z = -((500*Math.sqrt(2))*Math.cos(camera.ry));
			
	var ctx = canvas3D.getContext("2d");
		
	auto = false;
	var aa = function (  ) {
	
		if(auto){
		camera.ry += (3.14/90);
		
		camera.y = ((500*Math.sqrt(2))*Math.sin(camera.rx));
			
		camera.x = -((500*Math.sqrt(2)*Math.cos(camera.rx))*Math.sin(camera.ry));
		camera.z = -((500*Math.sqrt(2)*Math.cos(camera.rx))*Math.cos(camera.ry));
		
		
		}
		camera.ry = camera.ry%(Math.PI*2);
		var span = document.getElementById("ry");
			span.innerHTML = (camera.ry * 180 / Math.PI).toFixed(2) + " deg";
		var spanx = document.getElementById("rx");
			spanx.innerHTML = (camera.rx * 180 / Math.PI).toFixed(2) + " deg";
	
		faces=[];
		vertices=[];
		
		document.getElementById("vertices").innerHTML = meshData.verticesrc.length;
		document.getElementById("faces").innerHTML = meshData.facesrc.length;
		
		
		
		createVertex(meshData.verticesrc);
					
		createFaces(meshData.facesrc);
		
		renderer.render(faces , camera);
				
	}
				
	timer.addAction(aa);
		
	
	
	
	//GraphContainer.getInstance().initResize();
	

}
var tex = new Image();
function run(){
	tex = new Image();	
	tex.src = "hulk.jpg";
	
	tex.onload = function() {   
		
		
		createVertex(meshData.verticesrc);
					
		createFaces(meshData.facesrc);
				
		timer.start();
		
	}
}
function check(){
	
		console.log(mesh.pointSvg);
		console.log(mesh.triangleSvg);
		console.log(mesh.lineSvg);
		console.log(mesh.getMeshData());
	}

function createVertex ( src ) {
		
	var len = src.length;
			
	for ( var i = 0 ; i < len ; i++ ) {
			
		var v = src[i];
		vertices.push( new  Vertex(v[0],v[1],v[2]) );
			
	}
		
}
		
function createFaces ( src ) {
		
	var len = src.length;
			
	for ( var i = 0 ; i < len ; i++ ) {
	
		var f = src[i];
				
		var face = new Face(vertices[f[0]-1],vertices[f[1]-1],vertices[f[2]-1]);
		
		face.setMaterial( tex ,meshData.uvsrc[i] );
		
		faces.push( face );
	
	}

}
</script>


<body style="position:relative">

<img src="hulk.jpg" width="500" height="500" style="position:absolute;right:0;top:0;"></img>
<svg xmlns="http://www.w3.org/2000/svg" id="mySvg"  style="position:absolute;right:0;top:0;border:1px solid black">
</svg>

<canvas id="myCanvas" style="position:absolute;left:0;top:0;background:black">
</canvas>

<input type="button" style="position:absolute;top:510px;left:0;" value="render" onclick="run();">
<input type="button" style="position:absolute;top:510px;left:60;" value="rotate" onclick="window.auto = window.auto === true?false:true">
<span style="position:absolute;left:10;top:10;font-size:12px;color:#eb0000">awakeJS beta</span>

<span style="position:absolute;left:10;top:30;font-size:12px;color:#ffffff">camera ry: <span id="ry"></span></span>
<span style="position:absolute;left:10;top:45;font-size:12px;color:#ffffff">camera rx: <span id="rx"></span></span>
<span style="position:absolute;left:10;top:60;font-size:12px;color:#ffffff">vertices: <span id="vertices"></span></span>
<span style="position:absolute;left:10;top:75;font-size:12px;color:#ffffff">faces: <span id="faces"></span></span>

</body>


</html>